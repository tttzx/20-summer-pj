# 20卓越软件开发 pj说明文档

18302010061 陶紫信

## 完成情况

- 基础部分全部完成

- Bonus部分完成了说明文档、局部放大、验证码、高级的搜索。

  

## 项目结构

<img src="C:\Users\surface\Desktop\微信截图_20200729173246.png" alt="微信截图_20200729173246" style="zoom:33%;" />

其中，java代码部分的文件夹内容如下。

- **DAO：**负责连接数据库。

- **Entity：**涉及到的图片、用户进行封装。

- **Servlet：**负责处理前端页面发来的请求。

  

## 功能展示与分析

### 首页

##### 有合适的轮播来展示最热的旅游图片

使用了bootstrap的轮播插件，并通过设置`data-interval="2000"`增加了切换轮播的时间间隔。

![微信截图_20200729200421](C:\Users\surface\Desktop\微信截图_20200729200421.png)



##### 下方合理排列最新的旅游图片，每一个最新旅游图片都包含作者、主题和发布时间。

![微信截图_20200729201621](C:\Users\surface\Desktop\微信截图_20200729201621.png)



### 详情界面

具有图片及图片信息，用户可以在这个界面收藏或者取消收藏。同时具有局部放大功能。

![微信截图_20200729201746](C:\Users\surface\Desktop\微信截图_20200729201746.png)



### 搜索

**可以根据标题筛选和根据主题查找，也可以根据热度排序和根据时间排序两个选项。**

搜索结果需要分页，每一页最多显示8张图片，通过ajax实现，不会刷新页面。 

<img src="C:\Users\surface\Desktop\微信截图_20200729202038.png" alt="微信截图_20200729202038" style="zoom: 33%;" />





### 登录

如图所示，同时实现了验证码功能。登录成功后会跳转到登录前页面。

![微信截图_20200729203446](C:\Users\surface\Desktop\微信截图_20200729203446.png)

验证码的实现：

```html
<canvas id="canvas" width="100px" height="50px"></canvas>
```

```javascript
//绘制验证码
//生成随机数
function randomNum(min, max) {
    return Math.floor(Math.random() * (max - min) + min);
}

//生成随机颜色RGB分量
function randomColor(min, max) {
    var _r = randomNum(min, max);
    var _g = randomNum(min, max);
    var _b = randomNum(min, max);
    return "rgb(" + _r + "," + _g + "," + _b + ")";
}

//先阻止画布默认点击发生的行为再执行drawPic()方法
document.getElementById("canvas").onclick = function (e) {
    e.preventDefault();
    drawPic();
};

var _picTxt = "";

function drawPic() {
    _picTxt = "";
    //获取到元素canvas
    var $canvas = document.getElementById("canvas");
    var _str = "0123456789";//设置随机数库
    var _num = 4;//4个随机数字
    var _width = $canvas.width;
    var _height = $canvas.height;
    var ctx = $canvas.getContext("2d");//获取 context 对象
    ctx.textBaseline = "bottom";//文字上下对齐方式--底部对齐
    ctx.fillStyle = randomColor(180, 240);//填充画布颜色
    ctx.fillRect(0, 0, _width, _height);//填充矩形--画画
    for (var i = 0; i < _num; i++) {
        var x = (_width - 10) / _num * i + 10;
        var y = randomNum(_height / 2, _height);
        var deg = randomNum(-30, 30);
        var txt = _str[randomNum(0, _str.length)];
        _picTxt += txt;//获取一个随机数
        ctx.fillStyle = randomColor(10, 100);//填充随机颜色
        ctx.font = randomNum(25, 40) + "px SimHei";//设置随机数大小，字体为SimHei
        ctx.translate(x, y);//将当前xy坐标作为原始坐标
        ctx.rotate(deg * Math.PI / 180);//旋转随机角度
        ctx.fillText(txt, 0, 0);//绘制填色的文本
        ctx.rotate(-deg * Math.PI / 180);
        ctx.translate(-x, -y);
    }
    for (var i = 0; i < _num; i++) {
        //定义笔触颜色
        ctx.strokeStyle = randomColor(90, 180);
        ctx.beginPath();
        //随机划线--4条路径
        ctx.moveTo(randomNum(0, _width), randomNum(0, _height));
        ctx.lineTo(randomNum(0, _width), randomNum(0, _height));
        ctx.stroke();
    }
    for (var i = 0; i < _num * 10; i++) {
        ctx.fillStyle = randomColor(0, 255);
        ctx.beginPath();
        //随机画原，填充颜色
        ctx.arc(randomNum(0, _width), randomNum(0, _height), 1, 0, 2 * Math.PI);
        ctx.fill();
    }
}

drawPic();
```

### 注册

可以实时判断用户名是否已经存在，并且实时检测密码的强弱。此外还可以验证邮箱格式不正确 ，密码与确认密码不一致等问题。

![微信截图_20200729203509](C:\Users\surface\Desktop\微信截图_20200729203509.png)

前端通过js验证密码强弱的算法如下：

```javascript
function getValue(password) {
    var value = 0;
    if (password.length >= 6 && password.length <= 12) {
        value = 1;
        for (var i = 0; i < password.length; i++) {
            var current = password.charCodeAt(i);
            //大写或小写字母
            if (((current >= 65 && current <= 90) || (current >= 97 && current <= 122))) {
                value = 2;
            }
            //特殊字符
            if (((current >= 33 && current <= 47) || (current >= 58 && current <= 64) || (current >= 91 && current <= 96) || (current >= 123 && current <= 126)) && password.length >= 8) {
                value = 3;
                break;
            }
        }
    }
    return value;
}
```

### 上传

可以选择本机图片并上传，选择图片后显示在左上角。

![微信截图_20200729202114](C:\Users\surface\Desktop\微信截图_20200729202114.png)



选择国家后，相应地区的自动匹配通过ajax实现。

```javascript
$.ajax({
    type: "post",
    async: false,
    url: "./getCity",
    data: {"country": country},
    timeout: 30000,
    data_type: 'json',
    success: function (data) {
        cities = JSON.parse(data).city;
    }, error: function () {
        alert("请求出错");
    }
});
if (cities) {
    city.empty().html(fillContents(cities));
}
```



### 我的照片

当用户上传过图片显示如下。可以在由界面跳转至修改图片信息，或删除图片。

![微信截图_20200729202543](C:\Users\surface\Desktop\微信截图_20200729202543.png)



如果用户没有上传过图片则显示：

![微信截图_20200729202521](C:\Users\surface\Desktop\微信截图_20200729202521.png)



### 我的收藏

显示用户收藏的所有图片，取消收藏按钮立即从“我的收藏”中移除。

“我的足迹”显示最近浏览过的10个图片标题，点击其中的任意标题跳转到相应详情页面。

通过修改**允许好友查看**的值可以保护用户隐私。

![微信截图_20200729202954](C:\Users\surface\Desktop\微信截图_20200729202954.png)



### 好友列表

该界面可以进行添加好友的操作，右侧搜索框可以搜索用户名或邮箱进行查找。

![微信截图_20200729203202](C:\Users\surface\Desktop\微信截图_20200729203202.png)

点击用户名跳转到收藏界面。显示：用户名+“的收藏”。

![微信截图_20200729203105](C:\Users\surface\Desktop\微信截图_20200729203105.png)



如果对方设置了不可被好友查看收藏，则会显示：

![微信截图_20200729203322](C:\Users\surface\Desktop\微信截图_20200729203322.png)



## project心得